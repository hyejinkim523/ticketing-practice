<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì¸í„°íŒŒí¬ í‹°ì¼“íŒ… ì—°ìŠµ</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f5f6f7;
}
.container {
    width: 900px;
    margin: 30px auto;
    background: white;
    padding: 20px;
    border: 1px solid #ccc;
}
.stage {
    text-align: center;
    background: #ddd;
    padding: 5px;
    margin-bottom: 15px;
}
.hidden {
    display: none;
}
.seat-area {
    display: grid;
    grid-template-columns: repeat(40, 14px);
    gap: 2px;
    justify-content: center;
    user-select: none;
}

.seat {
    width: 14px;
    height: 14px;
    background: #cce0ff;
    border: 1px solid #4a6fa5;
    cursor: pointer;
}

.seat.selected {
    background: #ff5b5b;
}
.seat.occupied {
    background: #888;
    cursor: not-allowed;
}
.timer {
    font-weight: bold;
    color: red;
}
.center {
    text-align: center;
    margin-top: 20px;
}
input {
    padding: 5px;
    font-size: 16px;
}
button {
    padding: 8px 20px;
    font-size: 16px;
    cursor: pointer;
}
button:disabled {
    background: #ccc;
    cursor: not-allowed;
}

/* ===== ëŒ€ê¸° í™”ë©´ ìœ„ì¹˜ ì¡°ì • (ë³´ë„ˆìŠ¤ íƒ€ì…) ===== */
#waiting {
    margin-top: 300px;
}

/* ===== êµ¬ì—­ ë§µ ===== */
.zone-map {
    text-align: center;
    margin-top: 20px;
}

.stage-map {
    width: 320px;
    margin: 0 auto 25px;
    padding: 12px 0;
    background: #ccc;
    font-weight: bold;
    letter-spacing: 2px;
}

.zone-row {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-bottom: 25px;
}

.zone {
    width: 140px;
    height: 90px;
    background: #6fa8dc;
    color: white;
    font-size: 26px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 10px;
    transition: all 0.15s ease;
}

.zone:hover {
    background: #3d85c6;
    transform: scale(1.05);
}

/* êµ¬ì—­ë³„ ìƒ‰ ì‚´ì§ ì°¨ì´ */
.zone-a { background: #6fa8dc; }
.zone-b { background: #5b9bd5; }
.zone-c { background: #4a86c5; }
.zone-d { background: #3d73b9; }

</style>
</head>

<body>
<div class="container">

    <!-- ì‹œì‘ ëŒ€ê¸° -->
    <div id="waiting">
        <div class="center">
            â³ ì˜ˆë§¤ ì‹œì‘ê¹Œì§€ ë‚¨ì€ ì‹œê°„  
            <div class="timer"><span id="waitTime">10</span>ì´ˆ</div>
        </div>
        <div class="center">
            <button id="startBtn" disabled>ì˜ˆë§¤ ì‹œì‘</button>
        </div>
    </div>

    <!-- ë¬¸ì ì…ë ¥ -->
    <div id="captcha" class="hidden center">
        <p>ì•„ë˜ ë¬¸ìë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
        <h2 id="captchaText"></h2>
        <input type="text" id="captchaInput" maxlength="6" style="text-transform: uppercase;">
        <br><br>
        <button onclick="checkCaptcha()">í™•ì¸</button>
    </div>

    <!-- ì¢Œì„ ì„ íƒ -->
    <!-- êµ¬ì—­ ì„ íƒ -->
<div id="zonePage" class="hidden zone-map">
    <div class="stage-map">STAGE</div>

    <!-- ì• êµ¬ì—­ -->
    <div class="zone-row">
        <div class="zone zone-a" onclick="enterZone('A1')">A1</div>
        <div class="zone zone-a" onclick="enterZone('A2')">A2</div>
        <div class="zone zone-a" onclick="enterZone('A3')">A3</div>
        <div class="zone zone-a" onclick="enterZone('A4')">A4</div>
    </div>

    <!-- ì¤‘ê°„ êµ¬ì—­ -->
    <div class="zone-row">
        <div class="zone zone-b" onclick="enterZone('B1')">B1</div>
        <div class="zone zone-b" onclick="enterZone('B2')">B2</div>
        <div class="zone zone-b" onclick="enterZone('B3')">B3</div>
        <div class="zone zone-b" onclick="enterZone('B4')">B4</div>
    </div>

    <!-- ë’¤ êµ¬ì—­ -->
    <div class="zone-row">
        <div class="zone zone-c" onclick="enterZone('C1')">C1</div>
        <div class="zone zone-c" onclick="enterZone('C2')">C2</div>
        <div class="zone zone-c" onclick="enterZone('C3')">C3</div>
        <div class="zone zone-c" onclick="enterZone('C4')">C4</div>
    </div>
</div>


<!-- ì¢Œì„ ì„ íƒ -->
<div id="seatPage" class="hidden">
    <div class="stage">STAGE</div>
    <div class="center"><strong id="zoneTitle"></strong></div>
    <br>
    <div class="seat-area" id="seatArea"></div>
    <div class="center">
    ì„ íƒ ì¢Œì„: <span id="count">0</span> / 1
</div>

<div class="center">
    <button id="confirmBtn" onclick="confirmSeat()" disabled>
        ì„ íƒ ì™„ë£Œ
    </button>
</div>

</div>

<!-- ê²°ê³¼ í˜ì´ì§€ -->
<div id="resultPage" class="hidden center">
    <h2>ì˜ˆë§¤ ê²°ê³¼</h2>
    <p>
    â±ï¸ ì†Œìš” ì‹œê°„:  
    <strong><span id="resultTime"></span>ì´ˆ</strong>
</p>

<p>
    ğŸ… ì´ë²ˆ ê¸°ë¡ ìˆœìœ„:
    <strong><span id="currentRank"></span>ìœ„</strong>
</p>

<p>
    âš¡ ì˜ˆë§¤ ì‹œì‘ í´ë¦­ ì˜¤ì°¨:
    <strong><span id="clickDiff"></span>ì´ˆ</strong>
</p>

    <hr style="margin:20px 0;">

    <h3>ğŸ† ì—­ëŒ€ ìµœê³  ê¸°ë¡ TOP 10</h3>
    <ol id="rankList"></ol>

    <br>
    <button onclick="location.reload()">ë‹¤ì‹œ ì—°ìŠµí•˜ê¸°</button>
</div>


<script>
/* ================= ëŒ€ê¸° íƒ€ì´ë¨¸ ================= */
let wait = 10;
const waitTime = document.getElementById("waitTime");
const startBtn = document.getElementById("startBtn");

const waitTimer = setInterval(() => {
    waitTime.innerText = wait;

if (wait < 0) {
    clearInterval(waitTimer);
    startBtn.disabled = false;
    waitTime.innerText = 0;

    openTime = performance.now(); // â±ï¸ ë²„íŠ¼ ì˜¤í”ˆ ì‹œê° ê¸°ë¡
    return;
}
    wait--;
}, 1000);

let openTime = 0;
let clickTime = 0;
let startTime = 0;
let endTime = 0;



startBtn.onclick = () => {
    clickTime = performance.now(); // â±ï¸ í´ë¦­ ì‹œê°
    startTime = clickTime;         // ì „ì²´ ì†Œìš” ì‹œê°„ ì‹œì‘ì 
    document.getElementById("waiting").classList.add("hidden");
    document.getElementById("captcha").classList.remove("hidden");
    generateCaptcha();
};




/* ================= ë¬¸ì ì…ë ¥ ================= */
let captchaAnswer = "";

function generateCaptcha() {
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    captchaAnswer = "";
    for (let i = 0; i < 6; i++) {
        const randomIndex = Math.floor(Math.random() * chars.length);
        captchaAnswer += chars[randomIndex];
    }
    document.getElementById("captchaText").innerText = captchaAnswer;
}

function checkCaptcha() {
    const input = document.getElementById("captchaInput").value.toUpperCase();
    if (input === captchaAnswer) {
        document.getElementById("captcha").classList.add("hidden");
        document.getElementById("zonePage").classList.remove("hidden");

    } else {
        alert("ë³´ì•ˆì½”ë“œê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!");
        document.getElementById("captchaInput").value = "";
        generateCaptcha(); // í‹€ë¦¬ë©´ ìƒˆ ì½”ë“œ
    }
}


document.getElementById("captchaInput").addEventListener("input", function () {
    this.value = this.value.toUpperCase();
});

document.getElementById("captchaInput").addEventListener("keydown", function (e) {
    if (e.key === "Enter") {
        checkCaptcha();
    }
});

function enterZone(zone) {
    document.getElementById("zonePage").classList.add("hidden");
    document.getElementById("seatPage").classList.remove("hidden");

    document.getElementById("zoneTitle").innerText = zone + "êµ¬ì—­";

    initSeats(zone);
}

/* ================= ì¢Œì„ ì„ íƒ ================= */
const seatArea = document.getElementById("seatArea");
const countText = document.getElementById("count");
let selectedCount = 0;
let maxSeat = 1;
let isMouseDown = false;

function initSeats(zone) {
    seatArea.innerHTML = "";
    selectedCount = 0;
    countText.innerText = 0;
    document.getElementById("confirmBtn").disabled = true;

let seatCount = 0;

// ì• êµ¬ì—­ (A1~A4)
if (zone.startsWith("A")) seatCount = 700;

// ì¤‘ê°„ êµ¬ì—­ (B1~B4)
if (zone.startsWith("B")) seatCount = 500;

// ë’¤ êµ¬ì—­ (C1~C4)
if (zone.startsWith("C")) seatCount = 350;


    for (let i = 0; i < seatCount; i++) {
        const seat = document.createElement("div");
        seat.className = "seat";

        if (Math.random() < 0.25) {
            seat.classList.add("occupied");
        }

        seat.addEventListener("mousedown", () => selectSeat(seat));
        seat.addEventListener("mouseover", () => {
            if (isMouseDown) selectSeat(seat);
        });

        seatArea.appendChild(seat);
    }
}


document.body.addEventListener("mousedown", () => isMouseDown = true);
document.body.addEventListener("mouseup", () => isMouseDown = false);

function selectSeat(seat) {
    if (seat.classList.contains("occupied")) return;
    if (seat.classList.contains("selected")) return;
    if (selectedCount >= maxSeat) return;

    seat.classList.add("selected");
    selectedCount++;
    countText.innerText = selectedCount;
    document.getElementById("confirmBtn").disabled = false;
}

function confirmSeat() {
    if (selectedCount !== maxSeat) {
        alert("ì¢Œì„ì„ ì„ íƒí•˜ì„¸ìš”.");
        return;
    }

    endTime = performance.now();
    const elapsed = Number(((endTime - startTime) / 1000).toFixed(2));

    // í´ë¦­ ì˜¤ì°¨ ê³„ì‚°
    const diff = Number(((clickTime - openTime) / 1000).toFixed(3));

    // ê¸°ë¡ ì €ì¥
    const records = saveRecord(elapsed);

    // í™”ë©´ ì „í™˜
    document.getElementById("seatPage").classList.add("hidden");
    document.getElementById("resultPage").classList.remove("hidden");


// ê²°ê³¼ í‘œì‹œ
document.getElementById("resultTime").innerText = elapsed;

document.getElementById("clickDiff").innerText =
    diff >= 0 ? `+${diff}` : `ì¡°ê¸° í´ë¦­ (${diff})`;

renderRank(records, elapsed);

}

function saveRecord(time) {
    let records = JSON.parse(localStorage.getItem("ticketRecords")) || [];

    records.push(time);
    records.sort((a, b) => a - b); // ë¹ ë¥¸ ìˆœ ì •ë ¬
    records = records.slice(0, 10); // TOP 10ë§Œ ìœ ì§€

    localStorage.setItem("ticketRecords", JSON.stringify(records));
    return records;
}

function renderRank(records, currentTime) {
    const rankList = document.getElementById("rankList");
    rankList.innerHTML = "";

    let currentRank = records.indexOf(currentTime) + 1;
    document.getElementById("currentRank").innerText = currentRank;

    records.forEach((time, index) => {
        const li = document.createElement("li");
        li.innerText = `${time}ì´ˆ`;
        rankList.appendChild(li);
    });
}


</script>
</body>
</html>
